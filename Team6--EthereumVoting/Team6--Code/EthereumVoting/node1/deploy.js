const { Web3 } = require('web3');
const web3 = new Web3('http://localhost:8551', null, {
  headers: {
    Authorization: 'Basic ' + Buffer.from('Hu910308').toString('base64')
  }
});

// Contract ABI and bytecode
const abi = [
  {"constant":false,"inputs":[{"name":"proposal","type":"uint256"}],"name":"vote","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},
  {"constant":true,"inputs":[{"name":"proposal","type":"uint256"}],"name":"showVoteCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"showResult","outputs":[{"name":"voteCounts","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"showWinningProposal","outputs":[{"name":"winningProposal","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":false,"inputs":[{"name":"voter","type":"address"}],"name":"giveRightToVote","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"name":"proposalNames","type":"bytes32[]"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}
];
const bytecode = '0x608060405234801561001057600080fd5b506040516106ee3803806106ee83398101806040528101908080518201929190505050600033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600160026000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000181905550600090505b81518110156101765760006040805190810160405280848481518110151561010957fe5b90602001906020020151600019168152602001600081525090806001815401808255809150509060018203906000526020600020906002020160009091929091909150600082015181600001906000191690556020820151816001015550505080806001019150506100e5565b5050610567806101876000396000f30060806040526004361061006d576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630121b93f1461007257806319da31411461009f57806333ee3131146100e0578063383510211461014c5780639e7b8d6114610177575b600080fd5b34801561007e57600080fd5b5061009d600480360381019080803590602001909291905050506101ba565b005b3480156100ab57600080fd5b506100ca60048036038101908080359060200190929190505050610290565b6040518082815260200191505060405180910390f35b3480156100ec57600080fd5b506100f56102cc565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561013857808201518184015260208101905061011d565b505050509050019250505060405180910390f35b34801561015857600080fd5b50610161610366565b6040518082815260200191505060405180910390f35b34801561018357600080fd5b506101b8600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506103e1565b005b6000600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209050600015158160010160009054906101000a900460ff16151514151561022157600080fd5b6000816000015411151561023457600080fd5b60018160010160006101000a81548160ff021916908315150217905550818160020181905550806000015460008381548110151561026e57fe5b9060005260206000209060020201600101600082825401925050819055505050565b60008080549050821015156102a457600080fd5b6000828154811015156102b357fe5b9060005260206000209060020201600101549050919050565b6060600080805490506040519080825280602002602001820160405280156103035781602001602082028038833980820191505090505b509150600090505b6000805490508110156103625760008181548110151561032757fe5b906000526020600020906002020160010154828281518110151561034757fe5b9060200190602002018181525050808060010191505061030b565b5090565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561043d57600080fd5b60001515600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff16151514151561049f57600080fd5b6000600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541415156104f057600080fd5b6001600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000181905550505600a165627a7a72305820f5d15790ad1e4ea43378be724db5654dbc3833df35dc7f06c18002ac83d920ac0029';
const proposalNames = ["Green", "White", "Blue"];

// Pad string values to make them 32 bytes
const paddedProposalNames = proposalNames.map(name => web3.utils.utf8ToHex(name.padEnd(32, '\0')));

// Deploy the contract
const deployAddress = '0xe54e806e70c34fb728dbc65285500d1bf07c4442';

const contract = new web3.eth.Contract(abi);
const deployTransaction = contract.deploy({
  data: bytecode,
  arguments: [paddedProposalNames]
});

// Send the transaction
deployTransaction.send({
  from: deployAddress,
  gas: '4700000'
})
.on('transactionHash', function(hash) {
  console.log('Transaction Hash:', hash);
})
.on('receipt', function(receipt) {
  console.log('Receipt:', receipt);
  console.log('Contract Address:', receipt.contractAddress);
})
.on('error', function(error) {
  console.error('Error:', error);
});